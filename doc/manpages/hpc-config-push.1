.TH "hpc\-config\-push (1)" "" "" "" ""
.SH NAME
.PP
hpc\-config\-push \- push puppet\-hpc configuration into central storage
.SH SYNOPSIS
.IP
.nf
\f[C]
hpc\-config\-push\ [\-h]\ [\-d]\ [\-c\ [CONF]]\ [\-e\ [ENVIRONMENT]]\ [\-V\ [VERSION]]
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\-\-full\-tmp\-cleanup]
\f[]
.fi
.SH DESCRIPTION
.PP
hpc\-config\-push makes available all the Puppet configuration into a
shared central storage to be used by hpc\-config\-apply on cluster
nodes.
The pushed data includes the public puppet\-hpc configuration, the
private data and files and packaged Puppet modules.
.SH OPTIONS
.IP
.nf
\f[C]
\-h,\ \-\-help\ \ \ \ \ \ \ \ \ \ \ \ show\ this\ help\ message\ and\ exit
\-d,\ \-\-debug\ \ \ \ \ \ \ \ \ \ \ Enable\ debug\ mode
\-c\ [CONF],\ \-\-conf\ [CONF]
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Path\ to\ the\ configuration\ file
\-e\ [ENVIRONMENT],\ \-\-environment\ [ENVIRONMENT]
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Name\ of\ the\ pushed\ environment
\-V\ [VERSION],\ \-\-version\ [VERSION]
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Version\ of\ the\ pushed\ config
\-\-full\-tmp\-cleanup\ \ \ \ Full\ tmp\ dir\ cleanup.
\-\-enable\-python\-warnings
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Enable\ some\ python\ warnings\ (deprecation\ and
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ future\ warnings\ are\ hidden\ by\ default)
\f[]
.fi
.SH DIRECTORY LAYOUT
.PP
The source directories to be pushed can be placed anywhere in the
development machine as long as they are all at the same directory.
The layout of this directory should be like in the example below:
.IP
.nf
\f[C]
some_directory/
├──\ private\-data/
│\ \ \ ├──\ files/
│\ \ \ │\ \ \ └──\ $CLUSTER/
│\ \ \ │\ \ \ \ \ \ \ ├──\ cluster/
│\ \ \ │\ \ \ \ \ \ \ └──\ $AREA/
│\ \ \ └──\ hieradata/
│\ \ \ \ \ \ \ ├──\ *.yaml
│\ \ \ \ \ \ \ └──\ $CLUSTER/
│\ \ \ \ \ \ \ \ \ \ \ ├──\ *.yaml
│\ \ \ \ \ \ \ \ \ \ \ ├──\ roles/
│\ \ \ \ \ \ \ \ \ \ \ │\ \ \ └──\ *.yaml
│\ \ \ \ \ \ \ \ \ \ \ └──\ areas/
│\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ └──\ $AREA.yaml
└──\ puppet\-hpc/
\f[]
.fi
.PP
Where:
.IP \[bu] 2
\f[I]$CLUSTER\f[] is a cluster name,
.IP \[bu] 2
\f[I]$AREA\f[] is an area name (see \f[B]AREAS\f[] section for more
details).
.PP
The \f[I]puppet\-hpc/\f[] directory is a checkout of Puppet\-HPC.
.PP
The \f[I]private\-data/\f[] directory contains all the specific data for
every clusters of your organization.
Please refer to Puppet\-HPC reference documentation for more details
about the files hierarchy of this directory.
It\[aq]s advised to also keep this in git and simply fetch a copy.
.PP
The destination should be shared between all the central storage
servers.
It must be accessible as a simple POSIX file system, via the Amazon S3
API or a set of SFTP servers.
.SH AREAS
.PP
\f[I]hpc\-config\-push\f[] supports splitting cluster configuration
environments into multiple areas for security purpose.
Each area has its own set of encryption keys.
Please refer to Puppet\-HPC reference documentation for more details on
this mechanism.
.PP
If multiple areas are declared into its configuration file,
\f[I]hpc\-config\-push\f[] considers the first area to be the
\f[B]main\f[] area.
As a requirement, all the encrypted files located into the
\f[I]private\-data/files/$CLUSTER\f[] directory must be encrypted with
the cluster \f[B]main\f[] area files encryption key, and all the eyaml
encrypted parameters in the
\f[I]private\-data/hieradata/$CLUSTER/areas\f[] file must be encrypted
with the cluster \f[B]main\f[] area eyaml encryption key.
.PP
When the configuration environment is pushed, \f[I]hpc\-config\-push\f[]
performs on\-the\-fly re\-encryption of area\[aq]s sensitive data using
area specific encryption keys.
It includes the encrypted files (*.enc) located in the \f[I]cluster\f[]
and the \f[I]$AREA\f[] subdirectories and the eyaml encrypted parameters
in the \f[I]$CLUSTER/areas/$AREA.yaml\f[] file.
.PP
Then, \f[I]hpc\-config\-push\f[] generates a subset of the configuration
environment for each area, excluding the sensitive data of all other
areas.
.PP
This way, each area only has access to its own sensitive data encrypted
with its own set of encryption keys.
.PP
By default, \f[I]hpc\-config\-push\f[] considers there is only one
\f[B]default\f[] area, and no re\-encryption is performed.
.SH CONFIGURATION FILE
.PP
The default configuration file is installed at
\f[C]/etc/hpc\-config/push.conf\f[] and it is a simple text file using
the INI file format (http://en.wikipedia.org/wiki/INI_file).
This file has a basic structure composed of sections, properties, and
values.
.PP
The \[aq][global]\[aq] section defines the defaults parameters used:
.IP
.nf
\f[C]
[global]
cluster\ =\ <cluster\ name>
environment\ =\ <default\ environment>
version\ =\ <default\ version>
areas\ =\ <list\ of\ cluster\ areas>
destination\ =\ <default\ directory\ on\ central\ storage>
mode\ =\ <push\ mode,\ can\ be\ \[aq]s3\[aq],\ \[aq]posix\[aq]\ or\ \[aq]sftp\[aq]>
\f[]
.fi
.PP
Optionally, it can include a \[aq][posix]\[aq] section:
.IP
.nf
\f[C]
[posix]
file_mode\ =\ <dest\ files\ mode\ as\ (octal)>
dir_mode\ =\ <dest\ directories\ mode\ (octal)>
\f[]
.fi
.PP
Or a \[aq][s3]\[aq] section:
.IP
.nf
\f[C]
[s3]
access_key\ =\ <access\ key\ for\ s3>
secret_key\ =\ <secret\ key\ for\ s3>
bucket_name\ =\ <bucket\ to\ use\ on\ s3>
host\ =\ <host\ where\ to\ push\ data>
port\ =\ <port\ to\ use>
\f[]
.fi
.PP
Or a \[aq][sftp]\[aq] section:
.IP
.nf
\f[C]
[sftp]
hosts\ =\ <host>[,<host>...]
username\ =\ <SSH\ username>
private_key\ =\ <Private\ key\ file\ path>
\f[]
.fi
.PP
And/or a \[aq][paths]\[aq] section:
.IP
.nf
\f[C]
[paths]
tmp\ =\ <tmp\ directory\ where\ to\ build\ the\ tarball>\ (default:\ /tmp/hpc\-config\-push)
puppethpc\ =\ <directory\ where\ to\ find\ the\ puppet\-hpc\ git\ repository>
\ \ \ \ \ \ \ \ \ \ \ \ (default:\ puppet\-hpc)
privatedata\ =\ <directory\ where\ to\ find\ the\ private\ data>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ hpc\-privatedata)
puppet_conf\ =\ <directory\ where\ to\ find\ puppet.conf\ file>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${privatedata}/puppet\-config/${global:cluster}/puppet.conf)
hiera_conf\ =\ <directory\ where\ to\ find\ the\ puppet.conf\ file>\ (default:
\ \ \ \ \ \ \ \ \ \ \ \ \ ${privatedata}/puppet\-config/${global:cluster}/hiera.yaml)
nodes_private\ =\ ${privatedata}/puppet\-config/${global:cluster}/cluster\-nodes.yaml
modules_generic\ =\ <directories\ where\ to\ find\ the\ generic\ puppet\ modules>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${puppethpc}/puppet\-config/cluster,
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ${puppethpc}/puppet\-config/modules,
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ /usr/share/puppet/modules\ )
modules_private\ =\ <directories\ where\ to\ find\ the\ private\ puppet\ modules>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${privatedata}/puppet\-config/${global:cluster}/modules)
manifests_generic\ =\ <directory\ where\ to\ find\ the\ generic\ manifests>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${puppethpc}/puppet\-config/manifests)
manifests_private\ =\ <directory\ where\ to\ find\ the\ private\ manifests>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${privatedata}/puppet\-config/${global:cluster}/manifests)
hieradata_generic\ =\ <directory\ where\ to\ find\ the\ generic\ Hiera\ files>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${puppethpc}/hieradata)
hieradata_private\ =\ <directory\ where\ to\ find\ the\ private\ Hiera\ files>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${privatedata}/hieradata)
files_private\ =\ <directory\ where\ to\ find\ all\ the\ private\ files\ to\ put\ on\ nodes>
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (default:\ ${privatedata}/files/${global:cluster})
\f[]
.fi
.PP
All the values in the \[aq][paths]\[aq] section are optional, if they
are not defined, the default value is used.
.SH EXAMPLES
.PP
To simply push the current configuration in the default environment:
.IP
.nf
\f[C]
hpc\-config\-push
\f[]
.fi
.PP
To push the current configuration in the \[aq]test\[aq] environment:
.IP
.nf
\f[C]
hpc\-config\-push\ \-e\ test
\f[]
.fi
.SH SEE ALSO
.PP
hpc\-config\-apply(1)
